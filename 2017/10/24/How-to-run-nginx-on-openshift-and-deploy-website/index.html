<!DOCTYPE html>
<html>
<head>
  
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>How to run nginx on openshift and deploy website? | Keyang&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Although Openshift is able to use docker images, it has much more restrictions on permissions. Thus not all docker images can work straight on Openshift. Unfortunately, the official nginx docker image">
<meta name="keywords" content="openshift,nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="How to run nginx on openshift and deploy website?">
<meta property="og:url" content="http://keyangxiang.com/2017/10/24/How-to-run-nginx-on-openshift-and-deploy-website/index.html">
<meta property="og:site_name" content="Keyang&#39;s Blog">
<meta property="og:description" content="Although Openshift is able to use docker images, it has much more restrictions on permissions. Thus not all docker images can work straight on Openshift. Unfortunately, the official nginx docker image">
<meta property="og:updated_time" content="2017-10-24T22:07:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to run nginx on openshift and deploy website?">
<meta name="twitter:description" content="Although Openshift is able to use docker images, it has much more restrictions on permissions. Thus not all docker images can work straight on Openshift. Unfortunately, the official nginx docker image">
  
    <link rel="alternative" href="/atom.xml" title="Keyang&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
 <script src="/js/require-jquery.js"></script>
 <script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "WebSite",
    "name" : "Keyang&#39;s Blog",
    "url" : "http://keyangxiang.com"
  }
</script>

<script type="application/ld+json">
  { "@context" : "http://schema.org",
    "@type" : "Organization",
    "name" : "Keyang Xiang",
    "url" : "http://keyangxiang.com",
    "logo": "https://avatars3.githubusercontent.com/u/1092855",
    "sameAs" : [ "" ]
  }
</script>

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars3.githubusercontent.com/u/1092855" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Keyang Xiang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">A home of Javascript</p>
		
		<script>
  (function() {
    var cx = '008262195500319463689:yox48pfjzha';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/blog">Blogs</a></li>
				        
							<li><a href="/archives">Articles</a></li>
				        
							<li><a href="/csvtojson">csvtojson</a></li>
				        
							<li><a href="/simplepsd">Simple PSD</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/keyang" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/cli/" style="font-size: 10px;">cli</a> <a href="/tags/css/" style="font-size: 20px;">css</a> <a href="/tags/docker/" style="font-size: 20px;">docker</a> <a href="/tags/express-js/" style="font-size: 10px;">express.js</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/macosx-trick/" style="font-size: 10px;">macosx trick</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mongoose-js/" style="font-size: 10px;">mongoose.js</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/node-js/" style="font-size: 20px;">node.js</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/openshift/" style="font-size: 10px;">openshift</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/raspberrypi/" style="font-size: 10px;">raspberrypi</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/web-javascript/" style="font-size: 10px;">web, javascript</a> <a href="/tags/wordpress/" style="font-size: 10px;">wordpress</a>
					</div>
				</section>
				

				

				
			</div>
		</div>
	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Keyang Xiang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars3.githubusercontent.com/u/1092855" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Keyang Xiang</h1>
			</hgroup>
			
			<p class="header-subtitle">A home of Javascript</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/blog">Blogs</a></li>
		        
					<li><a href="/archives">Articles</a></li>
		        
					<li><a href="/csvtojson">csvtojson</a></li>
		        
					<li><a href="/simplepsd">Simple PSD</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/keyang" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-How-to-run-nginx-on-openshift-and-deploy-website" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/24/How-to-run-nginx-on-openshift-and-deploy-website/" class="article-date">
  	<time datetime="2017-10-24T21:04:14.000Z" itemprop="datePublished">2017-10-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      How to run nginx on openshift and deploy website?
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openshift/">openshift</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Although Openshift is able to use docker images, it has much more restrictions on permissions. Thus not all docker images can work straight on Openshift. Unfortunately, the official <code>nginx</code> docker image does not work on openshift.</p>
<p>In this post, I will simply go through how to run <a href="https://access.redhat.com/containers/?tab=overview&amp;platform=openshift#/registry.access.redhat.com/rhscl/nginx-112-rhel7" target="_blank" rel="external">this</a> Official RedHat nginx image on Openshift and deploy a website onto it.</p>
<a id="more"></a>
<p>So, have your <a href="https://developers.openshift.com/managing-your-applications/client-tools.html" target="_blank" rel="external">openshift cli tool (oc)</a> ready, let’s get started.</p>
<h1 id="Step-1-Import-Image"><a href="#Step-1-Import-Image" class="headerlink" title="Step 1 - Import Image"></a>Step 1 - Import Image</h1><p>First, we need to import above image to our project as an image stream.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oc import-image registry.access.redhat.com/rhscl/nginx-112-rhel7:latest --confirm=<span class="literal">true</span></div></pre></td></tr></table></figure>
<p>The openshift will pull the image from the registry and register it locally as builder image which will allow building images along with source code of website.</p>
<h1 id="Step-2-Create-Build-Config-Deploy-website-source-code"><a href="#Step-2-Create-Build-Config-Deploy-website-source-code" class="headerlink" title="Step 2 - Create Build Config / Deploy website source code"></a>Step 2 - Create Build Config / Deploy website source code</h1><p>Before this step, you need to upload the whole website to a git repo accessible from Openshift instance. If you want to build from local folder, keep reading.</p>
<p>The image we imported in last step was a builder image – which cannot run without source code. This is <a href="https://docs.openshift.com/enterprise/3.2/architecture/core_concepts/builds_and_image_streams.html#source-build" target="_blank" rel="external">S2I</a> concept of Openshift. Thus before creating our nginx app, we need create a build config which builds the builder image with provided source code to a new image. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#oc new-build [BuilderImage]~[Source Code Repo]</span></div><div class="line">oc new-build nginx-112-rhel7~https://github.com/Keyang/keyang.github.io.git --name=myapp</div></pre></td></tr></table></figure>
<p>the <code>--name</code> parameter gives a name for the build config for convenience.</p>
<p>Then you can to start the build manually:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oc start-build myapp</div></pre></td></tr></table></figure>
<p>The command above will pull the code from repo and builder image will <code>assemble</code> the code into new built image for run.</p>
<h2 id="Build-Local-Source"><a href="#Build-Local-Source" class="headerlink" title="Build Local Source"></a>Build Local Source</h2><p>If you have no accessible git repo, it is able to build againt local source.</p>
<p>Slightly different, create a new build on current folder</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#oc new-build [BuilderImage]~[Source Code Repo]</span></div><div class="line">oc new-build nginx-112-rhel7~./ --name=myapp</div></pre></td></tr></table></figure>
<p>This will not actually upload the source code from current folder to Openshift but just create a build config. Thus we need to start the build with extra parameters:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oc start-build myapp --from-dir=./</div></pre></td></tr></table></figure>
<p>with <code>--from-dir</code> param, <code>oc</code> will upload content of current directory and builder image will <code>assemble</code> the code.</p>
<h1 id="Step-3-Create-App-Expose-App"><a href="#Step-3-Create-App-Expose-App" class="headerlink" title="Step 3 - Create App / Expose App"></a>Step 3 - Create App / Expose App</h1><p>Once the image <code>myapp</code> being built, we could create an app from it.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oc new-app myapp --name=myapp</div></pre></td></tr></table></figure>
<p>This will create corresponding <code>deployment config</code> and <code>service</code>. Once app is created, we could expose it through <code>router</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oc expose svc/myapp</div></pre></td></tr></table></figure>
<p>Once it is exposed, your nginx server and your website should be accessible with the route associated.</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/09/01/HTML5-XHR-download-binary-content-as-Blob/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Ajax (XHR) download binary content as Blob</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'keyangxiang'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Keyang Xiang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-29275086-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->





  </div>
</body>
</html>